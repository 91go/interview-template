name: Generate
on:
  workflow_call:
  workflow_dispatch:
  schedule:
    - cron: '0 0 1 * *'
permissions: write-all

env:
  NUM: 30
  RSS_TITLE: "interview-questions"
  RSS_DESCRIPTION: ""
  RSS_AUTHOR: "hhackin"
  RSS_MAIL: ""
  RSS_LINK: "https://github.com/hhackin"

jobs:
  issue-weekly:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/setup-go@v3
        with:
          go-version: '1.20'
      - uses: actions/checkout@v3
      - id: generate
        run: |
          go install github.com/91go/docs-training@latest
          echo -e "$(docs-training batch -w docs -n ${{ env.NUM }})" >> output.md
      - name: Convert Markdown to HTML
        run: |
          go install github.com/kpym/gm@latest
          gm output.md > output.html
      - name: Convert HTML to RSS
        run: |
          go install github.com/91go/feedgen@latest
          feedgen gen -f output.html -t ${{ env.RSS_TITLE }} -author ${{ env.RSS_AUTHOR }} -des ${{ env.RSS_DESCRIPTION }} -mail ${{ env.RSS_MAIL }} -link ${{ env.RSS_LINK }} > feed.xml
      - name: Commit files
        run: |
          git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add feed.xml
          git commit -m "Update site"
      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          branch: main
          github_token: ${{ secrets.GITHUB_TOKEN }}